# Математическое описание системы CyberSec

## 1. Основная математическая модель
![image](https://github.com/user-attachments/assets/09f70486-0d3b-4e5d-9f88-cf73521f434b)

Система CyberSec основана на фундаментальном представлении ECDSA в пятимерном пространстве $(r, s, z, k, d)$, где:

- $r$ - x-координата точки $R = kG$ на эллиптической кривой
- $s$ - второй компонент подписи, вычисляемый как $s = (z + r \cdot d) \cdot k^{-1} \mod n$
- $z$ - хеш-значение сообщения ($z = H(m)$)
- $k$ - случайное число (nonce), используемое при генерации подписи
- $d$ - приватный ключ

**Уравнение ECDSA**: $s \cdot k \equiv z + r \cdot d \mod n$

### 1.1. Биективная параметризация

**Теорема 1 (Биективность параметризации)**: Отображение $\phi: (r,s,z) \mapsto (u_r,u_z)$ является биекцией между множеством допустимых подписей и множеством $\mathbb{F}_n^2$, где:

$$u_r \equiv r \cdot s^{-1} \bmod n, \quad u_z \equiv z \cdot s^{-1} \bmod n$$

*Разъяснение*: Это ключевое открытие позволяет упростить анализ ECDSA, переходя от трехмерного пространства $(r,s,z)$ к двумерному пространству $(u_r, u_z)$. В системе CyberSec эта биекция используется для преобразования подписей в параметризующее пространство, где структура ECDSA становится явной и поддается анализу.

### 1.2. Геометрическая интерпретация

Точка $R$ на эллиптической кривой может быть выражена как:

$$R = u_r \cdot Q + u_z \cdot G = (u_r \cdot d + u_z) \cdot G = k \cdot G$$

Это соотношение показывает, что:

- При фиксированном $u_r$, изменение $u_z$ на $\Delta u$ изменяет $k$ на $\Delta u$
- При фиксированном $u_z$, изменение $u_r$ на $\Delta u$ изменяет $k$ на $\Delta u \cdot d$

*Разъяснение*: В системе CyberSec это соотношение используется для построения градиентного метода анализа и анализа сдвиговых инвариантов, которые являются основными инструментами обнаружения уязвимостей.

## 2. Градиентная формула восстановления ключа

**Теорема 2 (Градиентный метод)**: Для фиксированного приватного ключа $d$, функция $r(u_r, u_z)$ удовлетворяет следующему соотношению:

$$d \equiv -\left(\frac{\partial r}{\partial u_z} \right) \Big/ \left(\frac{\partial r}{\partial u_r} \right) \bmod n$$

*Разъяснение*: Эта формула лежит в основе одного из основных методов анализа в CyberSec. Система оценивает частные производные $\partial r/\partial u_z$ и $\partial r/\partial u_r$ по набору подписей и вычисляет статистическую оценку приватного ключа $d$. Если оценка имеет малую дисперсию, это указывает на потенциальную уязвимость в генерации nonce.

В системе CyberSec реализован метод `_check_gradient_security()`, который:
1. Вычисляет приближенные частные производные для каждой подписи
2. Собирает статистику по оценкам ключа $d$
3. Оценивает дисперсию оценок
4. Если дисперсия ниже ожидаемой ($\sigma < \sqrt{n}/2 \cdot 0.5$), система обнаруживает уязвимость

## 3. Топологическая структура решений ECDSA

**Теорема 3 (Топология решений)**: Множество решений $\mathcal{S}_d = \{(r,s,z,k) \in \mathbb{F}_n^4 : \exists k \in \mathbb{F}_n \text{ такое, что } s \cdot k \equiv z + r \cdot d \bmod n\}$ для фиксированного приватного ключа $d$ топологически эквивалентно (гомеоморфно) двумерному тору $\mathbb{S}^1 \times \mathbb{S}^1$.

*Разъяснение*: Это топологическое свойство используется в CyberSec для анализа структуры подписей. Система вычисляет числа Бетти множества точек $(u_r, u_z)$ и сравнивает их с теоретическими значениями для тора ($b_0=1$, $b_1=2$, $b_2=1$). Отклонения от этих значений указывают на уязвимости.

Метод `_compute_betti_numbers()` в CyberSec:
1. Собирает точки $(u_r, u_z)$ из подписей
2. Вычисляет попарные расстояния и строит матрицу расстояний
3. Проводит иерархическую кластеризацию
4. Определяет количество компонент связности (число Бетти $b_0$)
5. Если $b_0 > 1$, система обнаруживает уязвимость (недостаточная энтропия)

## 4. Динамическая система на торе

**Следствие**: Процесс генерации подписей можно рассматривать как дискретную динамическую систему на торе:

$$\begin{pmatrix} u_r^{(t+1)} \\ u_z^{(t+1)} \end{pmatrix} = f\left(\begin{pmatrix} u_r^{(t)} \\ u_z^{(t)} \end{pmatrix}\right)$$

с показателем Ляпунова $\lambda \sim \log d$.

*Разъяснение*: В CyberSec это свойство используется для анализа "хаотичности" системы. Ключи с большим $d$ создают более хаотичные динамические системы, что повышает безопасность.

Метод `_compute_topological_entropy()` вычисляет топологическую энтропию:

$$h_{top} = \lim_{m \to \infty} \frac{1}{m} \log N(m, \epsilon)$$

где $N(m, \epsilon)$ — минимальное число $\epsilon$-покрытий для $m$-итераций отображения.

Если $h_{top} < \log n - 5.0$, система обнаруживает уязвимость, связанную с предсказуемостью nonce.

## 5. Сдвиговые инварианты

**Теорема 4 (Сдвиг строк)**: Строка $u_r+1$ сдвинута относительно строки $u_r$ на $d$ позиций:

$$r(u_r+1, u_z) = r(u_r, u_z - d) \mod n$$

*Разъяснение*: Это свойство лежит в основе метода анализа сдвиговых инвариантов в CyberSec. Система вычисляет корреляцию между соседними строками таблицы $(u_r, u_z) \mapsto r$ и ищет сдвиг, при котором корреляция максимальна.

Метод `_check_shift_invariants_security()`:
1. Строит таблицу значений $r$ в пространстве $(u_r, u_z)$
2. Для каждой пары соседних строк вычисляет корреляцию при различных сдвигах
3. Если максимальная корреляция превышает ожидаемую в 2 раза, система обнаруживает уязвимость

## 6. Зеркальные пары

**Теорема 5 (Зеркальные пары)**: Если для $(u_r, u_z)$ x-координата равна $x$, то для $(u_r, u_z')$ с одинаковой x-координатой выполняется:

$$u_z + u_z' \equiv -2 \cdot u_r \cdot d \mod n$$

*Разъяснение*: В CyberSec этот метод используется для проверки структурной целостности системы. Если оценки $d$, полученные из зеркальных пар, имеют малую дисперсию, это указывает на уязвимость.

Метод `_check_mirror_pairs_security()`:
1. Группирует точки с одинаковым $r$
2. Для каждой пары точек вычисляет оценку $d$
3. Анализирует дисперсию оценок
4. Если дисперсия меньше ожидаемой в 5 раз, система обнаруживает уязвимость

## 7. DFT-анализ

**Теорема 6 (DFT-анализ)**: Приватный ключ $d$ может быть восстановлен через дискретное преобразование Фурье функции $r(u_r, u_z)$:

$$\hat{d} = -\frac{n}{2\pi} \arg\left(\frac{1}{m} \sum_{u_r=0}^{m-1} \frac{\hat{f}_{u_r+1}(1)}{\hat{f}_{u_r}(1)}\right) \mod n$$

*Разъяснение*: В CyberSec этот метод используется для обнаружения периодичности в генерации nonce. Если фазы имеют малую дисперсию, это указывает на предсказуемость.

Метод `_check_dft_security()`:
1. Для каждой пары соседних строк вычисляет DFT
2. Анализирует дисперсию фаз отношений DFT
3. Если дисперсия фаз меньше ожидаемой ($\pi/\sqrt{3} \cdot 0.5$), система обнаруживает уязвимость

## 8. Топологическая энтропия и безопасность

**Теорема 7**: Топологическая энтропия отображения $(u_r, u_z) \mapsto r$ связана с безопасностью ECDSA:

$$h_{top}(T) = \log \max(1, |d|)$$

*Разъяснение*: В CyberSec эта теорема используется для количественной оценки безопасности. Ключи с высокой топологической энтропией обеспечивают лучшую защиту.

Система вычисляет топологическую энтропию как:

$$h_{top} = \log L(d)$$

где $L(d)$ - длина кривой в пространстве $(u_r, u_z)$.

Если $h_{top} < \log n - 5.0$, система рекомендует повысить уровень безопасности.

## 9. Энтропия параметризации

**Следствие**: Энтропия параметризации $H(u_r, u_z)$ связана с устойчивостью ECDSA к атакам через неравенство:

$$H(u_r, u_z) \geq \log_2 n - \frac{1}{2} \log_2 \left(1 +|\nabla r|^2\right)$$

*Разъяснение*: В CyberSec это неравенство используется для оценки качества генерации nonce. Низкая энтропия указывает на предсказуемость.

Метод `check_security()` вычисляет энтропию через:

$$H(u_r, u_z) = H(r) - \frac{1}{2} \log_2 \det(JJ^T)$$

где $J$ - матрица Якоби отображения $(u_r, u_z) \mapsto r$.

## 10. Расстояние Вассерштейна

**Следствие**: Для ECDSA с хорошей энтропией $W_2(\mu, \nu) \approx 0$, а для уязвимых реализаций $W_2(\mu, \nu)$ значительно больше.

*Разъяснение*: В CyberSec расстояние Вассерштейна используется как количественный критерий для оценки равномерности распределения параметров $(u_r, u_z)$.

Метод `_compute_wasserstein_distance()`:
1. Генерирует равномерное распределение для сравнения
2. Вычисляет среднее расстояние между точками из подписей и равномерного распределения
3. Если расстояние превышает $\sqrt{n}/5.0$, система обнаруживает уязвимость

## 11. Интеграция методов в системе CyberSec

Система CyberSec объединяет все эти методы в единую систему анализа безопасности:

1. **Сбор данных**: Загрузка подписей из файлов или генерация искусственных подписей
2. **Параметризация**: Преобразование подписей в пространство $(u_r, u_z)$
3. **Многоуровневый анализ**:
   - Градиентный анализ
   - Анализ сдвиговых инвариантов
   - DFT-анализ
   - Анализ зеркальных пар
   - Топологический анализ (числа Бетти, топологическая энтропия)
   - Анализ расстояния Вассерштейна
4. **Обнаружение уязвимостей**: Выявление отклонений от теоретических ожиданий
5. **Генерация отчета**: Детальный отчет с описанием уязвимостей и рекомендациями
6. **Применение мер защиты**: Автоматическое повышение уровня безопасности и генерация новых ключей

## 12. Принципиальные особенности системы

1. **Защита, а не взлом**: Все методы направлены на обнаружение уязвимостей для их устранения, а не для эксплуатации
2. **Многоуровневый подход**: Использование всех доступных методов анализа для повышения надежности
3. **Количественные критерии**: Четкие математические критерии для определения уязвимостей
4. **Рекомендации по усилению безопасности**: Конкретные рекомендации на основе обнаруженных проблем
5. **Автоматическое применение мер защиты**: Возможность автоматического повышения уровня безопасности

## 13. Практическая ценность

Система CyberSec предоставляет:

1. **Инструмент для аудита**: Проверка безопасности существующих реализаций ECDSA
2. **Критерии для разработки**: Математически обоснованные критерии для создания безопасных реализаций
3. **Методы верификации**: Инструменты для проверки качества генерации nonce
4. **Раннее обнаружение уязвимостей**: Выявление проблем до их эксплуатации

Важно отметить, что система не предназначена для практического взлома, а служит инструментом для повышения безопасности криптографических систем. Как указано в разделе 14.1 исследований, "предложенные методы анализа служат скорее инструментом для проверки качества реализации, чем средством практической атаки".

Система CyberSec реализует глубокую математическую структуру ECDSA, объединяя дифференциальную геометрию, топологию, теорию информации и теорию динамических систем в единую систему анализа безопасности, что делает ее мощным инструментом для разработчиков и аудиторов криптографических систем.
